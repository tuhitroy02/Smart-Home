<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartHome – Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="app">

  <!-- ====== ADMIN SIDEBAR ====== -->
  <aside class="app-sidebar">
    <div class="brand">
      <div class="brand-mark">SH</div>
      <div class="brand-text">
        <div class="brand-title">SmartHome</div>
        <div class="brand-subtitle">Admin Panel</div>
      </div>
    </div>

    <nav class="main-nav">
      <a class="nav-item active" href="admin-dashboard.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/layout.svg" alt="">
        Overview
      </a>
      <a class="nav-item" href="#user-management">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/users.svg" alt="">
        Users
      </a>
      <a class="nav-item" href="devices.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/cpu.svg" alt="">
        Devices
      </a>
      <a class="nav-item" href="schedules.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/calendar.svg" alt="">
        Schedules
      </a>
      <a class="nav-item" href="logs.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/book-open.svg" alt="">
        Logs & Security
      </a>
      <a class="nav-item" href="settings.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/settings.svg" alt="">
        System Settings
      </a>
      <a class="nav-item" href="dashboard.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/user.svg" alt="">
        Home Owner View
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="profile">
        <img class="avatar-img" src="https://cdn-icons-png.flaticon.com/512/2922/2922510.png" alt="">
        <div>
          <div class="name">System Admin</div>
          <div class="small-muted">Full access</div>
        </div>
      </div>
      <a class="signout" href="admin-login.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/log-out.svg" alt="">
        Sign out
      </a>
    </div>
  </aside>

  <!-- ====== MAIN CONTENT ====== -->
  <main class="app-main">
    <!-- HEADER -->
    <header class="app-header">
      <div>
        <h1>Admin Dashboard</h1>
        <p class="small-muted">
          Here admin performs all major operations from DFD Level 2:
          user registration, device control, scheduling, energy monitoring and security management.
        </p>
      </div>
    </header>

    <!-- TOP STATS -->
    <section class="grid-3">
      <article class="card">
        <h2 class="card-title">Total Users</h2>
        <p class="card-value" id="stat-users">0</p>
        <p class="small-muted">Registered home owners and family members.</p>
      </article>

      <article class="card">
        <h2 class="card-title">Admin Accounts</h2>
        <p class="card-value" id="stat-admins">0</p>
        <p class="small-muted">People who can access this admin panel.</p>
      </article>

      <article class="card">
        <h2 class="card-title">Open Alerts</h2>
        <p class="card-value">3</p>
        <p class="small-muted">Security / connectivity alerts from logs.</p>
      </article>
    </section>

    <!-- USER MANAGEMENT (REGISTER / REMOVE USERS, ADMIN MGMT) -->
    <section id="user-management" class="card" style="margin-top:1.5rem;">
      <h2 class="card-title">User & Admin Management</h2>
      <p class="small-muted">
        Admin can register new users, promote them to admin, or remove them.
        (Data is stored in browser localStorage for this front-end demo.)
      </p>

      <!-- Add user form -->
      <form id="addUserForm" class="grid-4" style="margin-top:1rem; gap:0.75rem;">
        <div class="field">
          <label class="label">Full Name</label>
          <input class="input" name="name" required placeholder="e.g. Rohan Sharma">
        </div>
        <div class="field">
          <label class="label">Email</label>
          <input class="input" name="email" type="email" required placeholder="user@example.com">
        </div>
        <div class="field">
          <label class="label">Home / House Name</label>
          <input class="input" name="home" required placeholder="e.g. Sharma Residence">
        </div>
        <div class="field">
          <label class="label">Role</label>
          <select class="input" name="role">
            <option value="user">User</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div style="grid-column:1 / -1; margin-top:0.5rem;">
          <button type="submit" class="btn-primary">Add / Register User</button>
        </div>
      </form>

      <!-- Users table -->
      <div style="margin-top:1rem; overflow-x:auto;">
        <table class="log-table" id="usersTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Home</th>
              <th>Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- filled by JS -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- ENERGY & SECURITY SECTIONS (to match DFD 0.2.3 & 0.2.4) -->
    <section class="two-col" style="margin-top:1.5rem;">
      <!-- Energy Monitoring -->
      <div class="card">
        <h2 class="card-title">Energy Monitoring</h2>
        <p class="small-muted">
          High-level view of total energy usage across all homes (demo values).
        </p>
        <ul class="compact-list" style="margin-top:0.75rem;">
          <li>Today's total: 42 kWh</li>
          <li>Peak hour: 19:00 – 21:00</li>
          <li>Most consuming device: Living Room AC</li>
        </ul>
      </div>

      <!-- Security Management -->
      <div class="card">
        <h2 class="card-title">Security Management</h2>
        <p class="small-muted">
          Recent security-related events. Admin can open full history in the Logs page.
        </p>
        <ul class="compact-list" style="margin-top:0.75rem;">
          <li><strong>Lock alert</strong> – 2 failed PIN attempts at Front Door Lock</li>
          <li><strong>Camera offline</strong> – Kitchen camera disconnected</li>
          <li><strong>New device</strong> – Smart Plug added in Study Room</li>
        </ul>
        <div class="chip-row" style="margin-top:0.75rem;">
          <a href="logs.html" class="btn-ghost">View full logs</a>
          <a href="settings.html" class="btn-ghost">Security settings</a>
        </div>
      </div>
    </section>

    <footer class="app-footer">
      <p>© SmartHome — Admin Panel (front-end demo, data stored in browser only).</p>
    </footer>
  </main>

  <!-- JS for user management -->
  <script>
    // Use localStorage key for users list
    const STORAGE_KEY = 'smarthome_admin_users';

    function loadUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        return [];
      }
    }

    function saveUsers(users) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
    }

    // Some default demo users (only on first load)
    function ensureDemoUsers() {
      let users = loadUsers();
      if (users.length === 0) {
        users = [
          { name: 'Rohan Sharma',  email: 'rohan@example.com',  home: 'Sharma Residence',  role: 'user'  },
          { name: 'Ananya Singh', email: 'ananya@example.com', home: 'Skyline Apartment', role: 'user'  },
          { name: 'System Admin', email: 'admin@smarthome.com', home: 'Global',           role: 'admin' }
        ];
        saveUsers(users);
      }
    }

    function renderUsersTable() {
      const tbody = document.querySelector('#usersTable tbody');
      tbody.innerHTML = '';
      const users = loadUsers();

      users.forEach((u, index) => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.home}</td>
          <td>${u.role === 'admin' ? 'Admin' : 'User'}</td>
          <td>
            <button class="btn-ghost small" data-action="promote" data-index="${index}">
              ${u.role === 'admin' ? 'Make User' : 'Make Admin'}
            </button>
            <button class="btn-ghost small" data-action="delete" data-index="${index}">
              Remove
            </button>
          </td>
        `;

        tbody.appendChild(tr);
      });

      // Update stats
      const totalUsers = users.length;
      const adminCount = users.filter(u => u.role === 'admin').length;
      document.getElementById('stat-users').textContent  = totalUsers;
      document.getElementById('stat-admins').textContent = adminCount;
    }

    document.addEventListener('DOMContentLoaded', () => {
      ensureDemoUsers();
      renderUsersTable();

      // Handle add user
      const form = document.getElementById('addUserForm');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const user = {
          name:  formData.get('name').trim(),
          email: formData.get('email').trim(),
          home:  formData.get('home').trim(),
          role:  formData.get('role')
        };
        if (!user.name || !user.email || !user.home) {
          alert('Please fill all fields');
          return;
        }
        const users = loadUsers();
        users.push(user);
        saveUsers(users);
        form.reset();
        renderUsersTable();
      });

      // Handle promote / delete buttons using event delegation
      document.querySelector('#usersTable tbody').addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;
        const index = parseInt(btn.dataset.index, 10);
        const action = btn.dataset.action;
        const users = loadUsers();

        if (action === 'delete') {
          if (confirm('Remove this user?')) {
            users.splice(index, 1);
            saveUsers(users);
            renderUsersTable();
          }
        } else if (action === 'promote') {
          users[index].role = users[index].role === 'admin' ? 'user' : 'admin';
          saveUsers(users);
          renderUsersTable();
        }
      });
    });
  </script>
</body>
</html>
