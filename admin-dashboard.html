<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartHome – Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Admin-only layout tweaks so it looks cleaner than user side -->
  <style>
    body.app--admin {
      background: #f4f6ff;
    }

    .admin-shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 32px 40px;
    }

    .app--admin .app-main {
      padding: 0; /* we use admin-shell padding instead */
    }

    .admin-header-text h1 {
      margin-bottom: 4px;
    }

    .admin-header-text p {
      max-width: 640px;
    }

    .admin-grid-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-top: 18px;
    }

    .admin-grid-3 .card {
      padding: 18px 20px;
    }

    .admin-grid-3 .card-value {
      font-size: 1.8rem;
      margin-bottom: 4px;
    }

    .admin-two-col {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 18px;
      margin-top: 20px;
    }

    @media (max-width: 900px) {
      .admin-two-col {
        grid-template-columns: 1fr;
      }
    }

    #usersTable {
      min-width: 100%;
      font-size: 0.9rem;
    }

    #usersTable td:last-child {
      white-space: nowrap;
    }

    .btn-ghost.small {
      font-size: 0.75rem;
      padding: 4px 8px;
      margin-left: 4px;
    }

    .admin-section-title {
      margin-top: 24px;
      margin-bottom: 4px;
    }

    .admin-card-tight {
      padding: 18px 20px;
      margin-top: 12px;
    }
  </style>
</head>
<body class="app app--admin">

  <!-- ====== ADMIN SIDEBAR ====== -->
  <aside class="app-sidebar">
    <div class="brand">
      <div class="brand-mark">SH</div>
      <div class="brand-text">
        <div class="brand-title">SmartHome</div>
        <div class="brand-subtitle">Admin Panel</div>
      </div>
    </div>

    <nav class="main-nav">
      <a class="nav-item active" href="admin-dashboard.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/layout.svg" alt="">
        Overview
      </a>
      <a class="nav-item" href="#user-management">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/users.svg" alt="">
        Users
      </a>
      <a class="nav-item" href="devices.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/cpu.svg" alt="">
        Devices
      </a>
      <a class="nav-item" href="schedules.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/calendar.svg" alt="">
        Schedules
      </a>
      <a class="nav-item" href="logs.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/book-open.svg" alt="">
        Logs & Security
      </a>
      <a class="nav-item" href="settings.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/settings.svg" alt="">
        System Settings
      </a>
      <a class="nav-item" href="dashboard.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/user.svg" alt="">
        Home Owner View
      </a>
    </nav>

    <div class="sidebar-footer">
      <div class="profile">
        <img class="avatar-img" src="https://cdn-icons-png.flaticon.com/512/2922/2922510.png" alt="">
        <div>
          <div class="name">System Admin</div>
          <div class="small-muted">Full access</div>
        </div>
      </div>
      <a class="signout" href="admin-login.html">
        <img class="nav-icon" src="https://cdn.jsdelivr.net/npm/feather-icons/dist/icons/log-out.svg" alt="">
        Sign out
      </a>
    </div>
  </aside>

  <!-- ====== MAIN CONTENT ====== -->
  <main class="app-main">
    <div class="admin-shell">

      <!-- HEADER -->
      <header class="app-header" style="padding: 0 0 12px 0; border-bottom: none;">
        <div class="admin-header-text">
          <h1>Admin Dashboard</h1>
          <p class="small-muted">
            Central control for your smart home platform. Admin can register users, manage devices,
            configure schedules, monitor energy usage and review security events.
          </p>
        </div>
      </header>

      <!-- TOP STATS -->
      <section class="admin-grid-3">
        <article class="card">
          <h2 class="card-title">Total Users</h2>
          <p class="card-value" id="stat-users">0</p>
          <p class="small-muted">Registered home owners and family members.</p>
        </article>

        <article class="card">
          <h2 class="card-title">Admin Accounts</h2>
          <p class="card-value" id="stat-admins">0</p>
          <p class="small-muted">People who can access this admin panel.</p>
        </article>

        <article class="card">
          <h2 class="card-title">Open Alerts</h2>
          <p class="card-value">3</p>
          <p class="small-muted">Security / connectivity alerts from activity logs.</p>
        </article>
      </section>

      <!-- USER MANAGEMENT + ENERGY/SECURITY -->
      <h2 class="admin-section-title">User & Admin Management</h2>
      <p class="small-muted">
        Admin can register new users, promote them to admin, or remove them
        (data stored in browser localStorage for this demo).
      </p>

      <section id="user-management" class="card admin-card-tight">
        <!-- Add user form -->
        <form id="addUserForm" class="grid-4" style="gap:0.75rem;">
          <div class="field">
            <label class="label">Full Name</label>
            <input class="input" name="name" required placeholder="e.g. Rohan Sharma">
          </div>
          <div class="field">
            <label class="label">Email</label>
            <input class="input" name="email" type="email" required placeholder="user@example.com">
          </div>
          <div class="field">
            <label class="label">Home / House Name</label>
            <input class="input" name="home" required placeholder="e.g. Sharma Residence">
          </div>
          <div class="field">
            <label class="label">Role</label>
            <select class="input" name="role">
              <option value="user">User</option>
              <option value="admin">Admin</option>
            </select>
          </div>

          <div style="grid-column:1 / -1; margin-top:0.5rem;">
            <button type="submit" class="btn-primary">Add / Register User</button>
          </div>
        </form>

        <!-- Users table -->
        <div style="margin-top:1rem; overflow-x:auto;">
          <table class="log-table" id="usersTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Home</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- filled by JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- ENERGY + SECURITY ROW -->
      <section class="admin-two-col">
        <!-- Energy Monitoring -->
        <div class="card admin-card-tight">
          <h2 class="card-title">Energy Monitoring</h2>
          <p class="small-muted">
            High-level view of estimated energy usage across all registered homes (demo values).
          </p>
          <ul class="compact-list" style="margin-top:0.75rem;">
            <li>Today's total usage: 42 kWh</li>
            <li>Peak time: 19:00 – 21:00</li>
            <li>Most consuming device: Living Room AC</li>
            <li>Energy-saving scenes active: Morning, Evening</li>
          </ul>
        </div>

        <!-- Security Management -->
        <div class="card admin-card-tight">
          <h2 class="card-title">Security Management</h2>
          <p class="small-muted">
            Recent security-related events. Admin can open the full history on the Logs page.
          </p>
          <ul class="compact-list" style="margin-top:0.75rem;">
            <li><strong>Lock alert</strong> – 2 failed PIN attempts at Front Door Lock</li>
            <li><strong>Camera offline</strong> – Kitchen camera disconnected</li>
            <li><strong>New device</strong> – Smart Plug added in Study Room</li>
          </ul>
          <div class="chip-row" style="margin-top:0.75rem;">
            <a href="logs.html" class="btn-ghost">View full logs</a>
            <a href="settings.html" class="btn-ghost">Security settings</a>
          </div>
        </div>
      </section>

      <!-- DEVICE / SCHEDULE SHORTCUTS -->
      <section class="card admin-card-tight" style="margin-top:20px;">
        <h2 class="card-title">Device Control & Scheduling</h2>
        <p class="small-muted">
          Quick access to detailed pages where admin sends commands to devices and allocates schedules.
        </p>
        <div class="chip-row" style="margin-top:0.75rem;">
          <a href="devices.html" class="btn-primary">Open Device Control</a>
          <a href="schedules.html" class="btn-ghost">Open Scheduling</a>
        </div>
      </section>

      <footer class="app-footer" style="margin-top:20px; padding:8px 0 0 0;">
        <p>© SmartHome — Admin Panel (front-end demo, all data stored locally).</p>
      </footer>

    </div>
  </main>

  <!-- JS for user management -->
  <script>
    const STORAGE_KEY = 'smarthome_admin_users';

    function loadUsers() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) {
        return [];
      }
    }

    function saveUsers(users) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
    }

    function ensureDemoUsers() {
      let users = loadUsers();
      if (users.length === 0) {
        users = [
          { name: 'Rohan Sharma',  email: 'rohan@example.com',  home: 'Sharma Residence',  role: 'user'  },
          { name: 'Ananya Singh', email: 'ananya@example.com', home: 'Skyline Apartment', role: 'user'  },
          { name: 'System Admin', email: 'admin@smarthome.com', home: 'Global',           role: 'admin' }
        ];
        saveUsers(users);
      }
    }

    function renderUsersTable() {
      const tbody = document.querySelector('#usersTable tbody');
      tbody.innerHTML = '';
      const users = loadUsers();

      users.forEach((u, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.home}</td>
          <td>${u.role === 'admin' ? 'Admin' : 'User'}</td>
          <td>
            <button class="btn-ghost small" data-action="promote" data-index="${index}">
              ${u.role === 'admin' ? 'Make User' : 'Make Admin'}
            </button>
            <button class="btn-ghost small" data-action="delete" data-index="${index}">
              Remove
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      const totalUsers = users.length;
      const adminCount = users.filter(u => u.role === 'admin').length;
      document.getElementById('stat-users').textContent  = totalUsers;
      document.getElementById('stat-admins').textContent = adminCount;
    }

    document.addEventListener('DOMContentLoaded', () => {
      ensureDemoUsers();
      renderUsersTable();

      const form = document.getElementById('addUserForm');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const user = {
          name:  formData.get('name').trim(),
          email: formData.get('email').trim(),
          home:  formData.get('home').trim(),
          role:  formData.get('role')
        };
        if (!user.name || !user.email || !user.home) {
          alert('Please fill all fields');
          return;
        }
        const users = loadUsers();
        users.push(user);
        saveUsers(users);
        form.reset();
        renderUsersTable();
      });

      document.querySelector('#usersTable tbody').addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-action]');
        if (!btn) return;
        const index = parseInt(btn.dataset.index, 10);
        const action = btn.dataset.action;
        const users = loadUsers();

        if (action === 'delete') {
          if (confirm('Remove this user?')) {
            users.splice(index, 1);
            saveUsers(users);
            renderUsersTable();
          }
        } else if (action === 'promote') {
          users[index].role = users[index].role === 'admin' ? 'user' : 'admin';
          saveUsers(users);
          renderUsersTable();
        }
      });
    });
  </script>
</body>
</html>
